<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tom's Chicken - Reset Password</title>
    <link href="Bootstrap/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="Bootstrap/Scripts/bootstrap.bundle.min.js"></script>
    <script src="Bootstrap/Scripts/bootstrap.min.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />

    <style>
      body {
        background-color: #f8f9fa;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .login-card {
        width: 100%;
        max-width: 400px;
        border-radius: 15px;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.95);
      }
      #ChickenBG {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
      }
    </style>
  </head>
  <body>
    <video width="100%" height="100%" id="ChickenBG" autoplay loop muted>
      <source src="Media/ChickenBG.mp4" type="video/mp4" />
    </video>

    <div class="card login-card shadow-lg border-0">
      <div
        class="card-header text-white text-center py-4"
        style="background-color: #f57d10ff"
      >
        <h3 class="fw-bold mb-0">Reset Password</h3>
        <small>Forgot your password? Don't worry, we got you.</small>
      </div>
      <div class="card-body p-4">
        <div id="alert-box" class="alert d-none small" role="alert"></div>

        <form id="resetForm">
          <p class="text-muted small text-center mb-3">
            Enter your registered email address. We'll send you a link to reset
            your password.
          </p>

          <div class="mb-4">
            <label class="form-label fw-bold small">Email Address</label>
            <input
              type="email"
              id="email"
              class="form-control"
              placeholder="name@example.com"
              required
            />
          </div>

          <button
            type="submit"
            id="resetBtn"
            class="btn w-100 py-2 text-white fw-bold"
            style="background-color: #f57d10ff"
          >
            SEND RESET LINK
          </button>
        </form>
      </div>
      <div class="card-footer text-center bg-white py-3">
        <small class="text-muted"
          >Remembered it?
          <a href="index.html" style="color: #f57d10ff; text-decoration: none"
            >Back to Login</a
          ></small
        >
      </div>
    </div>

    <script type="module">
      import { auth, sendPasswordResetEmail } from "./js/firebase-config.js";
      const form = document.getElementById("resetForm");
      const alertBox = document.getElementById("alert-box");
      const btn = document.getElementById("resetBtn");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("email").value;
        alertBox.classList.add("d-none");
        btn.innerHTML = "Sending...";
        btn.disabled = true;

        try {
          await sendPasswordResetEmail(auth, email);

          alertBox.textContent =
            "Email sent! Check your inbox and spam folder.";
          alertBox.classList.remove("d-none", "alert-danger");
          alertBox.classList.add("alert-success");
          btn.innerHTML = "LINK SENT";

          setTimeout(() => {
            // Redirect back to login after 4 seconds
            window.location.href = "index.html";
          }, 4000);
        } catch (error) {
          console.error(error);
          let msg = "Error sending email.";

          if (error.code === "auth/user-not-found") {
            msg = "Account does not exist.";
          } else if (error.code === "auth/invalid-email") {
            msg = "Please enter a valid email address.";
          }

          alertBox.textContent = msg;
          alertBox.classList.remove("d-none", "alert-success");
          alertBox.classList.add("alert-danger");
          btn.innerHTML = "SEND RESET LINK";
          btn.disabled = false;
        }
      });
    </script>
  </body>
</html>
