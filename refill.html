<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tom's Refill</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Mobile Tweaks */
        body { padding-bottom: 80px; } /* Space for bottom cart */
        .food-card img { height: 120px; object-fit: cover; }
    </style>
</head>
<body class="bg-light">

    <div id="codeSection" class="container vh-100 d-flex flex-column justify-content-center align-items-center">
        <div class="card p-4 shadow-sm text-center" style="width: 100%; max-width: 350px;">
            <img src="img/logo.png" style="height: 60px; margin-bottom: 20px;" alt="Logo"> <h4 class="fw-bold">Enter Code</h4>
            <p class="text-muted small">Enter the code from your receipt</p>
            
            <input type="text" id="receiptCode" class="form-control mb-3 text-center text-uppercase fw-bold" placeholder="e.g. WINGS-882">
            <button onclick="checkCode()" class="btn btn-danger w-100 rounded-pill py-2">ENTER</button>
        </div>
    </div>

    <div id="menuSection" class="d-none">
        <nav class="navbar navbar-dark bg-danger sticky-top shadow-sm">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1 fw-bold">Refilling Station</span>
                <span class="text-white small">Table 1</span>
            </div>
        </nav>

        <div class="container mt-3">
            <h6 class="text-muted fw-bold">FLAVORS</h6>
            <div class="row g-2" id="refillList">
                </div>
        </div>

        <div class="fixed-bottom p-3 bg-white border-top shadow-lg">
            <button onclick="sendRefillRequest()" class="btn btn-dark w-100 rounded-pill py-3 fw-bold d-flex justify-content-between align-items-center px-4">
                <span>View Cart</span>
                <span class="badge bg-danger rounded-circle">0</span>
            </button>
        </div>
    </div>

    <script type="module">
        import { db, ref, onValue, push } from "./JS/firebase-config.js";

        // A. THE "CHECK CODE" LOGIC
        window.checkCode = function() {
            const code = document.getElementById('receiptCode').value.toUpperCase();
            
            // For the demo, just hardcode a "valid" code so you can test
            if(code === "UNLI" || code.length > 3) {
                // Hide Code Screen, Show Menu
                document.getElementById('codeSection').classList.add('d-none');
                document.getElementById('menuSection').classList.remove('d-none');
                loadRefillItems();
            } else {
                alert("Invalid Code! Try 'UNLI'");
            }
        }

        // B. LOAD REFILL ITEMS FROM FIREBASE
        function loadRefillItems() {
            const menuRef = ref(db, 'menu_items');
            onValue(menuRef, (snapshot) => {
                const list = document.getElementById("refillList");
                list.innerHTML = "";
                
                snapshot.forEach((child) => {
                    const item = child.val();
                    // Only show "Refill" category items
                    if(item.category === "refill") {
                        list.innerHTML += `
                        <div class="col-6">
                            <div class="card border-0 shadow-sm h-100 food-card">
                                <div class="card-body text-center p-2">
                                    <h6 class="fw-bold mb-1">${item.name}</h6>
                                    <div class="d-flex justify-content-center align-items-center mt-2">
                                        <button class="btn btn-sm btn-outline-danger rounded-circle" style="width:30px; height:30px;">-</button>
                                        <span class="mx-2 fw-bold">0</span>
                                        <button class="btn btn-sm btn-danger rounded-circle" style="width:30px; height:30px;">+</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        `;
                    }
                });
            });
        }
    </script>
</body>
</html>